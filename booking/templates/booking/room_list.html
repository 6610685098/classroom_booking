{% extends "booking/base.html" %}

{% block content %}
    <h2>Room List</h2>

    {% if user.is_staff %}
        <a href="{% url 'booking:add_room' %}" class="action-button" style="margin-bottom: 20px; display: inline-block;">เพิ่มห้องใหม่</a>
    {% endif %}

    {% for data in rooms_data %}
    <div class="room-card">
        <div class="room-info">
            <div class="room-image">
                {% if data.room.image %}
                    <img src="{{ data.room.image.url }}" alt="{{ data.room.name }}">
                {% else %}
                    <img src="https://via.placeholder.com/220x160.png/fca311/ffffff?text=Booking+Room" alt="No image">
                {% endif %}
            </div>
            <div class="room-details">
                <h3>
                    {{ data.room.name }} ({{ data.room.room_code }})
                    {% if user.is_staff %}
                        <a href="{% url 'booking:edit_room' data.room.id %}" style="font-size: 0.6em; vertical-align: middle; margin-left: 10px;">แก้ไข</a>
                    {% endif %}
                </h3>
                <p><strong>ความจุ:</strong> {{ data.room.capacity }} คน</p>
                <p><strong>เวลาเปิด:</strong> {{ data.room.start_time_available|time:"H:i" }} - {{ data.room.end_time_available|time:"H:i" }}</p>
                
                <button class="action-button" data-target="#slots-{{ data.room.id }}">
                    เริ่มจอง
                </button>
            </div>
        </div>

        <div class="time-slots" id="slots-{{ data.room.id }}">
            {% for slot in data.hours %}
                {% if slot.is_booked %}
                    <button type="button" class="time-slot-btn is-booked" disabled>
                        {{ slot.hour }}:00
                    </button>
                {% else %}
                    <form action="{% url 'booking:book_room' data.room.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="start_time" value="{{ slot.hour }}:00">
                        <button type="submit" class="time-slot-btn is-available">
                            {{ slot.hour }}:00
                        </button>
                    </form>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% empty %}
        <div class="room-card">
            <p>ขออภัย, ขณะนี้ไม่มีห้องว่างให้จอง</p>
        </div>
    {% endfor %}

<script>
    document.querySelectorAll('.action-button').forEach(button => {
        if (button.hasAttribute('data-target')) {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                const timeSlotsDiv = document.querySelector(targetId);
                if (timeSlotsDiv) {
                    timeSlotsDiv.classList.toggle('visible');
                }
            });
        }
    });
</script>

{% endblock %}